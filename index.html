<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migration Dashboard - Standalone</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: #0a0e27;
            color: #e4e4e7;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            background: linear-gradient(135deg, #1a1f3a 0%, #2a1f3d 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(139,92,246,0.1) 0%, transparent 70%);
            animation: pulse 8s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        h1 {
            color: #a78bfa;
            font-size: 2.8em;
            margin-bottom: 10px;
            font-weight: 700;
            position: relative;
            z-index: 1;
            text-shadow: 0 0 30px rgba(167,139,250,0.5);
        }

        .subtitle {
            color: #9ca3af;
            font-size: 1.2em;
            position: relative;
            z-index: 1;
        }

        .toolbar {
            background: rgba(26,31,58,0.8);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.05);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Outfit', sans-serif;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(139,92,246,0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139,92,246,0.6);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #e4e4e7;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.15);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(139,92,246,0.1) 0%, rgba(99,102,241,0.1) 100%);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(139,92,246,0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #8b5cf6, #6366f1);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(139,92,246,0.3);
            border-color: rgba(139,92,246,0.5);
        }

        .stat-number {
            font-size: 3em;
            font-weight: 700;
            background: linear-gradient(135deg, #a78bfa 0%, #818cf8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #9ca3af;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 600;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: rgba(26,31,58,0.6);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }

        .chart-title {
            font-size: 1.3em;
            color: #e4e4e7;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .table-container {
            background: rgba(26,31,58,0.6);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }

        .search-box {
            margin-bottom: 20px;
            padding: 15px 20px;
            width: 100%;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(167,139,250,0.3);
            border-radius: 10px;
            font-size: 1em;
            color: #e4e4e7;
            font-family: 'Outfit', sans-serif;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: #8b5cf6;
            background: rgba(255,255,255,0.08);
            box-shadow: 0 0 20px rgba(139,92,246,0.3);
        }

        .search-box::placeholder {
            color: #6b7280;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        th {
            background: linear-gradient(135deg, rgba(139,92,246,0.3) 0%, rgba(99,102,241,0.3) 100%);
            color: #e4e4e7;
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95em;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: sticky;
            top: 0;
            border-bottom: 2px solid rgba(139,92,246,0.5);
        }

        th:first-child {
            border-top-left-radius: 10px;
        }

        th:last-child {
            border-top-right-radius: 10px;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            color: #d1d5db;
        }

        tr:hover {
            background: rgba(139,92,246,0.1);
        }

        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .badge-completed {
            background: rgba(16,185,129,0.2);
            color: #6ee7b7;
            border: 1px solid rgba(16,185,129,0.4);
        }

        .badge-pending {
            background: rgba(245,158,11,0.2);
            color: #fcd34d;
            border: 1px solid rgba(245,158,11,0.4);
        }

        .badge-ats {
            background: rgba(59,130,246,0.2);
            color: #93c5fd;
            border: 1px solid rgba(59,130,246,0.4);
        }

        .badge-bulk {
            background: rgba(239,68,68,0.2);
            color: #fca5a5;
            border: 1px solid rgba(239,68,68,0.4);
        }

        .badge-internal {
            background: rgba(168,85,247,0.2);
            color: #c4b5fd;
            border: 1px solid rgba(168,85,247,0.4);
        }

        .badge-wf {
            background: rgba(107,114,128,0.2);
            color: #d1d5db;
            border: 1px solid rgba(107,114,128,0.4);
        }

        input[type="text"], input[type="number"], input[type="date"], select, textarea {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(167,139,250,0.4);
            color: #e4e4e7;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Outfit', sans-serif;
            width: 100%;
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 10px rgba(139,92,246,0.3);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.2s ease;
            font-size: 1.1em;
        }

        .icon-btn:hover {
            background: rgba(139,92,246,0.2);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1f3a 0%, #2a1f3d 100%);
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #a78bfa;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #9ca3af;
            font-weight: 600;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 2000;
            animation: slideIn 0.3s ease;
            display: none;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .notification.info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2em;
            }

            .toolbar {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .scroll-container {
            max-height: 600px;
            overflow-y: auto;
        }

        .scroll-container::-webkit-scrollbar {
            width: 10px;
        }

        .scroll-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
        }

        .scroll-container::-webkit-scrollbar-thumb {
            background: rgba(139,92,246,0.5);
            border-radius: 5px;
        }

        .scroll-container::-webkit-scrollbar-thumb:hover {
            background: rgba(139,92,246,0.7);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .empty-state-title {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: #d1d5db;
        }

        .empty-state-text {
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ Migration Dashboard</h1>
            <p class="subtitle">Live Analytics & Data Management</p>
        </header>

        <div class="toolbar">
            <button class="btn btn-primary" onclick="addNewRecord()">
                <span>‚ûï</span> Add New Record
            </button>
            <button class="btn btn-success" onclick="exportToCSV()">
                <span>üì•</span> Export CSV
            </button>
            <button class="btn btn-secondary" onclick="importCSV()">
                <span>üì§</span> Import CSV
            </button>
            <div class="file-input-wrapper">
                <input type="file" id="csvFileInput" accept=".csv" onchange="handleFileImport(event)">
            </div>
            <button class="btn btn-danger" onclick="clearAllData()">
                <span>üóëÔ∏è</span> Clear All Data
            </button>
        </div>

        <div class="stats-grid" id="statsGrid"></div>

        <div class="charts-grid" id="chartsGrid">
            <div class="chart-card">
                <h3 class="chart-title">Migration Types Distribution</h3>
                <canvas id="migrationTypeChart"></canvas>
            </div>
            <div class="chart-card">
                <h3 class="chart-title">Source ATS Distribution</h3>
                <canvas id="sourceATSChart"></canvas>
            </div>
            <div class="chart-card">
                <h3 class="chart-title">Completion Status</h3>
                <canvas id="statusChart"></canvas>
            </div>
            <div class="chart-card">
                <h3 class="chart-title">TAT Distribution</h3>
                <canvas id="tatChart"></canvas>
            </div>
        </div>

        <div class="table-container">
            <h3 class="chart-title">Migration Records</h3>
            <input type="text" id="searchBox" class="search-box" placeholder="üîç Search by account name, ATS, or migration type...">
            <div class="scroll-container">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th>Account</th>
                            <th>Status</th>
                            <th>Type</th>
                            <th>Source ATS</th>
                            <th>Data Shared</th>
                            <th>Completed</th>
                            <th>TAT (Days)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
                <div id="emptyState" class="empty-state" style="display: none;">
                    <div class="empty-state-icon">üìä</div>
                    <div class="empty-state-title">No Migration Records Yet</div>
                    <div class="empty-state-text">Click "Add New Record" to start building your dashboard</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div id="recordModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-header" id="modalTitle">Add New Record</h2>
            <form id="recordForm">
                <div class="form-group">
                    <label>Account Name *</label>
                    <input type="text" id="accountInput" required>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="statusInput">
                        <option value="Completed from Migration Team">Completed from Migration Team</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Pending">Pending</option>
                        <option value="On Hold">On Hold</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Migration Type</label>
                    <select id="migrationTypeInput">
                        <option value="">Select Type</option>
                        <option value="ATS">ATS</option>
                        <option value="Bulk Parsing">Bulk Parsing</option>
                        <option value="Internal">Internal</option>
                        <option value="WF">WF</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Source ATS</label>
                    <input type="text" id="sourceATSInput" placeholder="e.g., Jobdiva, Bullhorn, Ceipal">
                </div>
                <div class="form-group">
                    <label>Data Shared Date</label>
                    <input type="date" id="dataSharedInput">
                </div>
                <div class="form-group">
                    <label>Migration Completed Date</label>
                    <input type="date" id="completedDateInput">
                </div>
                <div class="form-group">
                    <label>TAT (Days)</label>
                    <input type="number" id="tatDaysInput" min="0">
                </div>
                <div class="form-group">
                    <label>Comment</label>
                    <textarea id="commentInput" placeholder="Add any notes or comments..."></textarea>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 30px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Save</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()" style="flex: 1;">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        let migrationData = [];
        let charts = {};
        let editingIndex = null;

        // Load data from localStorage on startup
        function loadData() {
            const savedData = localStorage.getItem('migrationData');
            if (savedData) {
                migrationData = JSON.parse(savedData);
                showNotification('Loaded ' + migrationData.length + ' records from storage', 'info');
            } else {
                migrationData = [];
                showNotification('Dashboard ready! Add your first record to get started', 'info');
            }
            refreshDashboard();
        }

        function saveToLocalStorage() {
            localStorage.setItem('migrationData', JSON.stringify(migrationData));
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function calculateStats(data) {
            const stats = {
                total: data.length,
                completed: 0,
                pending: 0,
                migrationTypes: {},
                sourceATS: {},
                tatValues: []
            };

            data.forEach(record => {
                if (record.Migration_Completed_Date) {
                    stats.completed++;
                } else {
                    stats.pending++;
                }

                if (record.Migration_Type) {
                    stats.migrationTypes[record.Migration_Type] = (stats.migrationTypes[record.Migration_Type] || 0) + 1;
                }

                if (record.Source_ATS) {
                    stats.sourceATS[record.Source_ATS] = (stats.sourceATS[record.Source_ATS] || 0) + 1;
                }

                if (record.TAT_Days && !isNaN(record.TAT_Days)) {
                    stats.tatValues.push(parseInt(record.TAT_Days));
                }
            });

            stats.avgTAT = stats.tatValues.length > 0 
                ? (stats.tatValues.reduce((a, b) => a + b, 0) / stats.tatValues.length).toFixed(1)
                : 0;

            return stats;
        }

        function renderStats(stats) {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${stats.total}</div>
                    <div class="stat-label">Total Migrations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.completed}</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.pending}</div>
                    <div class="stat-label">Pending</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.avgTAT}</div>
                    <div class="stat-label">Avg TAT (Days)</div>
                </div>
            `;
        }

        function getMigrationTypeBadge(type) {
            const badges = {
                'ATS': 'badge-ats',
                'Bulk Parsing': 'badge-bulk',
                'Internal': 'badge-internal',
                'WF': 'badge-wf'
            };
            return badges[type] || 'badge-ats';
        }

        function getStatusBadge(record) {
            if (record.Migration_Completed_Date) {
                return 'badge-completed';
            }
            return 'badge-pending';
        }

        function renderTable(data) {
            const tableBody = document.getElementById('tableBody');
            const emptyState = document.getElementById('emptyState');
            
            if (data.length === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            tableBody.innerHTML = data.map((record, index) => `
                <tr data-index="${index}">
                    <td><strong>${record.Account}</strong></td>
                    <td><span class="badge ${getStatusBadge(record)}">${record.Status}</span></td>
                    <td><span class="badge ${getMigrationTypeBadge(record.Migration_Type)}">${record.Migration_Type || '-'}</span></td>
                    <td>${record.Source_ATS || '-'}</td>
                    <td>${formatDate(record.Data_Shared_Date)}</td>
                    <td>${formatDate(record.Migration_Completed_Date)}</td>
                    <td>${record.TAT_Days || '-'}</td>
                    <td class="action-buttons">
                        <button class="icon-btn" onclick="editRecord(${index})" title="Edit">‚úèÔ∏è</button>
                        <button class="icon-btn" onclick="deleteRecord(${index})" title="Delete">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        function setupSearch() {
            const searchBox = document.getElementById('searchBox');
            searchBox.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = migrationData.filter(record => 
                    record.Account.toLowerCase().includes(searchTerm) ||
                    (record.Migration_Type && record.Migration_Type.toLowerCase().includes(searchTerm)) ||
                    (record.Source_ATS && record.Source_ATS.toLowerCase().includes(searchTerm))
                );
                renderTable(filtered);
            });
        }

        function updateCharts(stats) {
            // Destroy existing charts
            Object.values(charts).forEach(chart => chart.destroy());
            charts = {};

            // Don't render charts if no data
            if (stats.total === 0) {
                document.getElementById('chartsGrid').style.display = 'none';
                return;
            }
            document.getElementById('chartsGrid').style.display = 'grid';

            // Migration Types Chart
            if (Object.keys(stats.migrationTypes).length > 0) {
                charts.migrationTypeChart = new Chart(document.getElementById('migrationTypeChart'), {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(stats.migrationTypes),
                        datasets: [{
                            data: Object.values(stats.migrationTypes),
                            backgroundColor: ['#8b5cf6', '#6366f1', '#ec4899', '#14b8a6'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: '#e4e4e7', font: { size: 12 } }
                            }
                        }
                    }
                });
            }

            // Source ATS Chart
            if (Object.keys(stats.sourceATS).length > 0) {
                charts.sourceATSChart = new Chart(document.getElementById('sourceATSChart'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(stats.sourceATS),
                        datasets: [{
                            label: 'Count',
                            data: Object.values(stats.sourceATS),
                            backgroundColor: '#8b5cf6',
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { stepSize: 1, color: '#9ca3af' },
                                grid: { color: 'rgba(255,255,255,0.05)' }
                            },
                            x: {
                                ticks: { color: '#9ca3af' },
                                grid: { display: false }
                            }
                        }
                    }
                });
            }

            // Status Chart
            charts.statusChart = new Chart(document.getElementById('statusChart'), {
                type: 'pie',
                data: {
                    labels: ['Completed', 'Pending'],
                    datasets: [{
                        data: [stats.completed, stats.pending],
                        backgroundColor: ['#10b981', '#f59e0b'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#e4e4e7', font: { size: 12 } }
                        }
                    }
                }
            });

            // TAT Distribution Chart
            if (stats.tatValues.length > 0) {
                const tatRanges = {
                    '0-10 days': 0,
                    '11-20 days': 0,
                    '21-30 days': 0,
                    '31+ days': 0
                };

                stats.tatValues.forEach(tat => {
                    if (tat <= 10) tatRanges['0-10 days']++;
                    else if (tat <= 20) tatRanges['11-20 days']++;
                    else if (tat <= 30) tatRanges['21-30 days']++;
                    else tatRanges['31+ days']++;
                });

                charts.tatChart = new Chart(document.getElementById('tatChart'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(tatRanges),
                        datasets: [{
                            label: 'Migrations',
                            data: Object.values(tatRanges),
                            backgroundColor: '#6366f1',
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { stepSize: 1, color: '#9ca3af' },
                                grid: { color: 'rgba(255,255,255,0.05)' }
                            },
                            x: {
                                ticks: { color: '#9ca3af' },
                                grid: { display: false }
                            }
                        }
                    }
                });
            }
        }

        function refreshDashboard() {
            const stats = calculateStats(migrationData);
            renderStats(stats);
            renderTable(migrationData);
            updateCharts(stats);
            setupSearch();
        }

        function addNewRecord() {
            editingIndex = null;
            document.getElementById('modalTitle').textContent = 'Add New Record';
            document.getElementById('recordForm').reset();
            document.getElementById('recordModal').classList.add('active');
        }

        function editRecord(index) {
            editingIndex = index;
            const record = migrationData[index];
            
            document.getElementById('modalTitle').textContent = 'Edit Record';
            document.getElementById('accountInput').value = record.Account;
            document.getElementById('statusInput').value = record.Status;
            document.getElementById('migrationTypeInput').value = record.Migration_Type || '';
            document.getElementById('sourceATSInput').value = record.Source_ATS || '';
            document.getElementById('dataSharedInput').value = record.Data_Shared_Date || '';
            document.getElementById('completedDateInput').value = record.Migration_Completed_Date || '';
            document.getElementById('tatDaysInput').value = record.TAT_Days || '';
            document.getElementById('commentInput').value = record.Comment || '';
            
            document.getElementById('recordModal').classList.add('active');
        }

        function deleteRecord(index) {
            if (confirm('Are you sure you want to delete this record?')) {
                migrationData.splice(index, 1);
                saveToLocalStorage();
                refreshDashboard();
                showNotification('Record deleted successfully!', 'success');
            }
        }

        function closeModal() {
            document.getElementById('recordModal').classList.remove('active');
        }

        document.getElementById('recordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newRecord = {
                Account: document.getElementById('accountInput').value,
                Status: document.getElementById('statusInput').value,
                Migration_Type: document.getElementById('migrationTypeInput').value,
                Source_ATS: document.getElementById('sourceATSInput').value,
                Data_Shared_Date: document.getElementById('dataSharedInput').value,
                Migration_Completed_Date: document.getElementById('completedDateInput').value,
                TAT_Days: document.getElementById('tatDaysInput').value,
                Comment: document.getElementById('commentInput').value
            };
            
            if (editingIndex !== null) {
                migrationData[editingIndex] = newRecord;
                showNotification('Record updated successfully!', 'success');
            } else {
                migrationData.push(newRecord);
                showNotification('Record added successfully!', 'success');
            }
            
            saveToLocalStorage();
            refreshDashboard();
            closeModal();
        });

        function exportToCSV() {
            if (migrationData.length === 0) {
                showNotification('No data to export!', 'error');
                return;
            }

            const headers = ['Account', 'Status', 'Migration_Type', 'Source_ATS', 'Data_Shared_Date', 
                            'Migration_Completed_Date', 'TAT_Days', 'Comment'];
            
            let csv = headers.join(',') + '\n';
            
            migrationData.forEach(record => {
                const row = headers.map(header => {
                    const value = record[header] || '';
                    return `"${value.toString().replace(/"/g, '""')}"`;
                });
                csv += row.join(',') + '\n';
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'migration_data_' + new Date().toISOString().split('T')[0] + '.csv';
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification('CSV exported successfully!', 'success');
        }

        function importCSV() {
            document.getElementById('csvFileInput').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const csvText = e.target.result;
                    const importedData = parseCSV(csvText);
                    
                    if (confirm(`Import ${importedData.length} records? This will replace your current data.`)) {
                        migrationData = importedData;
                        saveToLocalStorage();
                        refreshDashboard();
                        showNotification('CSV imported successfully!', 'success');
                    }
                };
                reader.readAsText(file);
            }
        }

        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let char of lines[i]) {
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            values.push(current.trim().replace(/^"|"$/g, ''));
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    values.push(current.trim().replace(/^"|"$/g, ''));
                    
                    const record = {};
                    headers.forEach((header, index) => {
                        record[header] = values[index] || '';
                    });
                    data.push(record);
                }
            }
            
            return data;
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete ALL records? This cannot be undone!')) {
                migrationData = [];
                localStorage.removeItem('migrationData');
                refreshDashboard();
                showNotification('All data cleared!', 'success');
            }
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Initialize
        loadData();
    </script>
</body>
</html>
